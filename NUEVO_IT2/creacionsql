--- Sentencias SQL para la creación del esquema de parranderos
--- Las tablas tienen prefijo A_ para facilitar su acceso desde SQL Developer

-- USO
-- Copie el contenido de este archivo en una pestaña SQL de SQL Developer
-- Ejecútelo como un script - Utilice el botón correspondiente de la pestaña utilizada

-- Creación del secuenciador
create sequence parranderos_sequence;

-- Creaación de la tabla USUARIO y especificación de sus restricciones
CREATE TABLE USUARIO
(
  ID NUMBER,
  EMAIL VARCHAR2 (255 BYTE),
  NOMBRE VARCHAR2 (255 BYTE),
  NUMERODOCUMENTO NUMBER (20,0),
  ROL VARCHAR2(50 BYTE),
  TIPODOCUMENTO VARCHAR2 (255 BYTE),
  CONSTRAINT USUARIO PRIMARY KEY (ID));


ALTER TABLE USUARIO
MODIFY NUMERODOCUMENTO NOT NULL
  ENABLE;

  ALTER TABLE USUARIO
  ADD  CHECK (ID>0)
ENABLE;

ALTER TABLE USUARIO
ADD CHECK (ROL IN ('AFILIADO', 'DOCTOR', 'GERENTE' , 'RECEPCIONISTA ', 'GERENTE' )) 
ENABLE;
  -- Creaación de la tabla GERENTE y especificación de sus restricciones
CREATE TABLE GERENTE
   (ID NUMBER, 
    IDGERENTEUSUARIO NUMBER, 
    CONSTRAINT GERENTE PRIMARY KEY (ID));

ALTER TABLE GERENTE
  ADD  CHECK (ID>0)
ENABLE;

ALTER TABLE GERENTE
  ADD CONSTRAINT FK_USUARIOGERENTE
  FOREIGN KEY (IDGERENTEUSUARIO)
  REFERENCES USUARIO(ID)
ENABLE;
-- Creaación de la tabla EPS y especificación de sus restricciones
CREATE TABLE EPS 
   (ID NUMBER, 
  NOMBRE VARCHAR2(255 BYTE), 
  IDGERENTE NUMBER, 
  CONSTRAINT EPS PRIMARY KEY (ID));
  
ALTER TABLE EPS
  ADD  CHECK (ID>0)
ENABLE;

ALTER TABLE EPS
ADD CONSTRAINT FK_GERENTE
    FOREIGN KEY (IDGERENTE)
    REFERENCES GERENTE(id)
ENABLE;
-- Creaación de la tabla IPS y especificación de sus restricciones
CREATE TABLE IPS 
   (ID NUMBER, 
    IDEPS NUMBER,
  LOCALIZACION VARCHAR2(255 BYTE), 
  NOMBRE VARCHAR2 (255 BYTE), 
  CONSTRAINT IPS PRIMARY KEY (ID));
  
ALTER TABLE IPS
 ADD  CHECK (ID>0)
ENABLE;

ALTER TABLE IPS
ADD CONSTRAINT FK_EPS
    FOREIGN KEY (IDEPS)
    REFERENCES GERENTE(id)
ENABLE;


--inicio contratos
CREATE TABLE CONTRATOS
(
  IDEPS NUMBER,
  IDIPS NUMBER,
  CONSTRAINT CONTRATOS PRIMARY KEY (IDEPS,IDIPS)
);

ALTER TABLE CONTRATOS
ADD CONSTRAINT FK_CONTRATOSJOIN
    FOREIGN KEY (IDEPS)
    REFERENCES EPS(ID)
ENABLE;

ALTER TABLE CONTRATOS
ADD CONSTRAINT FK_JOINCONTRATOSIPS
    FOREIGN KEY (IDIPS)
    REFERENCES IPS(ID)
ENABLE;
--fin contratos

--inicio dirige 
CREATE TABLE DIRIGE
(
  IDGERENTE NUMBER,
  IDEPS NUMBER,
  CONSTRAINT DIRIGE PRIMARY KEY (IDGERENTE,IDEPS)
);

ALTER TABLE DIRIGE
ADD CONSTRAINT FK_DIRIGEJOIN
    FOREIGN KEY (IDGERENTE)
    REFERENCES GERENTE(ID)
ENABLE;

ALTER TABLE DIRIGE
ADD CONSTRAINT FK_JOINDIRIGEEPS
    FOREIGN KEY (IDEPS)
    REFERENCES EPS(ID)
ENABLE;
--fin dirige





CREATE TABLE ADMINISTRADOR
(
  ID NUMBER,
  IDUSUARIO NUMBER,
  IDEPS NUMBER,
  CONSTRAINT ADMINISTRADOR PRIMARY KEY (ID)
);

ALTER TABLE ADMINISTRADOR 
ADD CHECK (ID > 0)
ENABLE; 

ALTER TABLE ADMINISTRADOR
ADD CONSTRAINT IDUSUARIOADMINISTRADOR
FOREIGN KEY (IDUSUARIO)
REFERENCES USUARIO(ID)
ENABLE;

ALTER TABLE ADMINISTRADOR 
ADD CONSTRAINT IDEPSADMINISTRADOR
FOREIGN KEY (IDEPS)
REFERENCES EPS(ID)
ENABLE;



--inicio adminstra 
CREATE TABLE ADMINISTRA
(
  IDADMINISTRADOR NUMBER,
  IDEPS NUMBER,
  CONSTRAINT ADMINSTRA PRIMARY KEY (IDADMINISTRADOR,IDEPS)
);

ALTER TABLE ADMINISTRA
ADD CONSTRAINT FK_ADMINISTRAJOIN
    FOREIGN KEY (IDADMINISTRADOR)
    REFERENCES ADMINISTRADOR(ID)
ENABLE;

ALTER TABLE ADMINISTRA
ADD CONSTRAINT FK_JOINADMINISTRAEPS
    FOREIGN KEY (IDEPS)
    REFERENCES EPS(ID)
ENABLE;
--fin administra


-- Creaación de la tabla VISITAN y especificación de sus restricciones
CREATE TABLE MEDICO 
(
  ID NUMBER,
  ESPECIALIDAD VARCHAR2 (255 BYTE),
  NUMEROREGISTRO VARCHAR2(255 BYTE), 
  FECHAVISITA DATE,
  IDUSUARIO NUMBER, 
  CONSTRAINT MEDICO PRIMARY KEY (ID)
);
ALTER TABLE MEDICO
ADD CONSTRAINT FK_USUARIOMEDICO
    FOREIGN KEY (IDUSUARIO)
    REFERENCES USUARIO(ID)
ENABLE;

ALTER TABLE MEDICO
  ADD   CHECK (ID>0)
ENABLE;

ALTER TABLE MEDICO
ADD CHECK (ESPECIALIDAD  IN ('PEDIATRIA','GINECOLOGIA','OPTOMETRIA','ODONTOLOGIA','LABORATORIO CLINICO','RAYOS X' ))
ENABLE;

CREATE TABLE SERVICIO 
(
  ID NUMBER,
  CAPACIDAD NUMBER,
  NOMBRE VARCHAR2 (50 BYTE),
  ESTADO VARCHAR2(255 BYTE),
  FECHA DATE, 
  HORARIOS VARCHAR2(255 BYTE),
  IDORDEN NUMBER, 
  IDIPS NUMBER,
  MEDICOS NUMBER,
  CONSTRAINT SERVICIO PRIMARY KEY (ID)
);

ALTER TABLE SERVICIO
ADD CHECK (NOMBRE  IN ('DISPONIBLE','RESERVADOPACIENTE','RESERVADOCAMPAÑA', 'NO_DISPONIBLE' ))
ENABLE;

ALTER TABLE SERVICIO
  ADD  CHECK (ID>0)
ENABLE;

ALTER TABLE SERVICIO 
ADD CONSTRAINT FK_IPSSERVICIO
    FOREIGN KEY (IDIPS)
    REFERENCES IPS(ID)
ENABLE;

ALTER TABLE SERVICIO
ADD CHECK (NOMBRE  IN ('PEDIATRIA','GINECOLOGIA','OPTOMETRIA','ODONTOLOGIA','LABORATORIO CLINICO','RAYOS X' ))
ENABLE;

CREATE TABLE CITA
(
  ID NUMBER,
  ASISTIO NUMBER,
  FECHA DATE,  
  IDSERVICIO NUMBER,
  NOMBRESERVICIO VARCHAR2 (255 BYTE),
  CONSTRAINT CITA PRIMARY KEY (ID)
); 

ALTER TABLE CITA
ADD CHECK (ID > 0)
ENABLE;  

ALTER TABLE CITA
ADD CONSTRAINT IDSERVICIOCITA
FOREIGN KEY (IDSERVICIO)
REFERENCES SERVICIO (ID)
ENABLE;

ALTER TABLE CITA
ADD CHECK (ASISTIO >= 0 AND ASISTIO <=1)
ENABLE;

ALTER TABLE CITA
ADD CHECK (NOMBRESERVICIO  IN ('PEDIATRIA','GINECOLOGIA','OPTOMETRIA','ODONTOLOGIA','LABORATORIO CLINICO','RAYOS X' ))
ENABLE;

-- Creaación de la tabla ORDEN y especificación de sus restricciones
CREATE TABLE ORDEN
   (ID NUMBER, 
   IDSERVICIO NUMBER, 
  CONSTRAINT ORDEN PRIMARY KEY (ID));
   
ALTER TABLE ORDEN
  ADD  CHECK (ID>0)
ENABLE;

ALTER TABLE ORDEN
  ADD CONSTRAINT FK_SERVICIOORDEN 
  FOREIGN KEY (IDSERVICIO)
  REFERENCES SERVICIO(ID)
ENABLE;

-- Creaación de la tabla AFILIADO y especificación de sus restricciones
CREATE TABLE AFILIADO
   (
    ID NUMBER, 
    ESTADOSALUD VARCHAR2 (255 BYTE), 
    FECHANACIMIENTO DATE,
    RECETAACTUAL VARCHAR2 (255 BYTE),
    IDORDEN NUMBER,
    IDUSUARIOAFILIADO NUMBER,
    IDEPS NUMBER,
    IDCITA NUMBER,  
    CONSTRAINT AFILIADO PRIMARY KEY (ID)
   );
  
ALTER TABLE AFILIADO
  ADD CHECK (ID>0)
ENABLE;

ALTER TABLE AFILIADO
 ADD CONSTRAINT FK_ORDENAFILIADO
   FOREIGN KEY (IDORDEN)
   REFERENCES ORDEN(ID)
   ENABLE; 

ALTER TABLE AFILIADO
 ADD CONSTRAINT FK_USUARIOAFILIADO
   FOREIGN KEY (IDUSUARIOAFILIADO)
   REFERENCES USUARIO(ID)
   ENABLE;

ALTER TABLE AFILIADO
ADD CONSTRAINT FK_IDEPS
FOREIGN KEY (IDEPS)
REFERENCES EPS(ID)
ENABLE;

ALTER TABLE AFILIADO 
ADD CONSTRAINT FK_CITAAFILIADO
FOREIGN KEY (IDCITA)
REFERENCES CITA(ID)
ENABLE;
   
   --inicio afiliacion 
CREATE TABLE AFILIACION
(
  IDAFILIADO NUMBER,
  IDEPS NUMBER,
  CONSTRAINT AFILIACION PRIMARY KEY (IDAFILIADO,IDEPS)
);

ALTER TABLE AFILIACION
ADD CONSTRAINT FK_AFILIACIONJOIN
    FOREIGN KEY (IDAFILIADO)
    REFERENCES AFILIADO(ID)
ENABLE;

ALTER TABLE AFILIACION
ADD CONSTRAINT FK_JOINAFILIACIONEPS
    FOREIGN KEY (IDEPS)
    REFERENCES EPS(ID)
ENABLE;
--fin afiliacion

   
-- Creaación de la tabla RECEPCIONISTA y especificación de sus restricciones
CREATE TABLE RECEPCIONISTA
(
  ID NUMBER,
  IDIPS NUMBER,
  IDUSUARIO NUMBER,
  CONSTRAINT RECEPCIONISTA PRIMARY KEY (ID)
);

ALTER TABLE RECEPCIONISTA
  ADD CONSTRAINT ID 
  CHECK (ID>0)
ENABLE;

ALTER TABLE RECEPCIONISTA
ADD CONSTRAINT FK_IPSRECEPCIONISTA
    FOREIGN KEY (IDIPS)
    REFERENCES IPS(id)
ENABLE;
    
ALTER TABLE RECEPCIONISTA
ADD CONSTRAINT FK_USUARIORECEPCIONISTA
    FOREIGN KEY (IDUSUARIO)
    REFERENCES USUARIO(id)
ENABLE;



--inicio CITAS
CREATE TABLE CITAS
(
  IDIPS NUMBER,
  IDCITA NUMBER,
  CONSTRAINT CITAS PRIMARY KEY (IDIPS,IDCITA)
);

ALTER TABLE CITAS
ADD CONSTRAINT FK_CITASJOIN
    FOREIGN KEY (IDIPS)
    REFERENCES IPS(ID)
ENABLE;

ALTER TABLE CITAS
ADD CONSTRAINT FK_JOINCITASCITA
    FOREIGN KEY (IDCITA)
    REFERENCES CITA(ID)
ENABLE;
--fin CITAS


--inicio RECIBEN
CREATE TABLE RECIBEN
(
  IDRECEPCIONISTA NUMBER,
  IDIPS NUMBER,
  CONSTRAINT RECIBEN PRIMARY KEY (IDRECEPCIONISTA,IDIPS)
);

ALTER TABLE RECIBEN
ADD CONSTRAINT FK_RECIBENJOIN
    FOREIGN KEY (IDRECEPCIONISTA)
    REFERENCES RECEPCIONISTA(ID)
ENABLE;

ALTER TABLE RECIBEN
ADD CONSTRAINT FK_JOINRECEPCIONISTAIPS
    FOREIGN KEY (IDIPS)
    REFERENCES IPS(ID)
ENABLE;
--fin reciben


--inicio ofrecen
CREATE TABLE OFRECEN
(
  IDIPS NUMBER,
  IDSERVICIO NUMBER,
  CONSTRAINT OFRECEN PRIMARY KEY (IDIPS,IDSERVICIO)
);

ALTER TABLE OFRECEN
ADD CONSTRAINT FK_OFRECENJOIN
    FOREIGN KEY (IDIPS)
    REFERENCES IPS(ID)
ENABLE;

ALTER TABLE OFRECEN
ADD CONSTRAINT FK_JOINOFRECENSERVICIO
    FOREIGN KEY (IDSERVICIO)
    REFERENCES SERVICIO(ID)
ENABLE;
--fin ofrecen


--inicio atendidas
CREATE TABLE ATENDIDAS
(
  IDRECEPCIONISTA NUMBER,
  IDCITA NUMBER,
  CONSTRAINT ATENDIDAS PRIMARY KEY (IDRECEPCIONISTA,IDCITA)
);

ALTER TABLE ATENDIDAS
ADD CONSTRAINT FK_ATENDIDASJOIN
    FOREIGN KEY (IDRECEPCIONISTA)
    REFERENCES RECEPCIONISTA(ID)
ENABLE;

ALTER TABLE ATENDIDAS
ADD CONSTRAINT FK_JOINATENDIDASCITA
    FOREIGN KEY (IDCITA)
    REFERENCES CITA(ID)
ENABLE;
--fin atendidas



--Creacion De la tabla campaña
CREATE TABLE CAMPANA 
   (ID NUMBER, 
  IDSERVICIO NUMBER,
  CONSTRAINT CAMPANA PRIMARY KEY (ID));
  
ALTER TABLE CAMPANA
  ADD  CHECK (ID>0)
ENABLE;

ALTER TABLE CAMPANA
ADD CONSTRAINT FK_SERVICIOCAMPANA
    FOREIGN KEY (IDSERVICIO)
    REFERENCES SERVICIO(id)
ENABLE;

--Creacion de la tabla organizado
CREATE TABLE ORGANIZADO
(
  IDCAMPANA NUMBER,
  IDSERVICIO NUMBER,
  CONSTRAINT ORGANIZADO PRIMARY KEY (IDCAMPANA,IDSERVICIO)
);

ALTER TABLE ORGANIZADO
ADD CONSTRAINT FK_CAMPANAJOIN
    FOREIGN KEY (IDCAMPANA)
    REFERENCES CAMPANA(ID)
ENABLE;

ALTER TABLE ORGANIZADO
ADD CONSTRAINT FK_IPSJOINCAMPANASERVICIO
    FOREIGN KEY (IDSERVICIO)
    REFERENCES SERVICIO(ID)
ENABLE;



--Creacion del Organizador de Campanas
CREATE TABLE ORGANIZADOR
(
  ID NUMBER,
  EPS NUMBER,
  CONSTRAINT ORGANIZADOR PRIMARY KEY (ID)
);

ALTER TABLE ORGANIZADOR
  ADD CONSTRAINT ORGANIZADORID
  CHECK (ID>0)
ENABLE;
    
ALTER TABLE ORGANIZADOR
ADD CONSTRAINT FK_EPSORGANIZADOR
    FOREIGN KEY (EPS)
    REFERENCES EPS(id)
ENABLE;

--Creacion de la tabla organiza
CREATE TABLE ORGANIZA
(
  IDORGANIZADOR NUMBER,
  IDCAMPANA NUMBER,
  CONSTRAINT ORGANIZA PRIMARY KEY (IDORGANIZADOR,IDCAMPANA)
);

ALTER TABLE ORGANIZA
ADD CONSTRAINT FK_ORGANIZAJOIN
    FOREIGN KEY (IDORGANIZADOR)
    REFERENCES ORGANIZADOR(ID)
ENABLE;

ALTER TABLE ORGANIZA
ADD CONSTRAINT FK_IPSJOINORGANIZADORCAMPANA
    FOREIGN KEY (IDCAMPANA)
    REFERENCES CAMPANA(ID)
ENABLE;
--Creacion JOIN
CREATE TABLE JOINRECEPCITA
(
  IDCITA NUMBER,
  IDRECEPCIONISTA NUMBER,
  CONSTRAINT JOINRECEPCITA PRIMARY KEY (IDCITA ,IDRECEPCIONISTA)
);  

ALTER TABLE JOINRECEPCITA
ADD CONSTRAINT IDCITAJOIN
FOREIGN KEY (IDCITA)
REFERENCES CITA(ID)
ENABLE;

ALTER TABLE JOINRECEPCITA
ADD CONSTRAINT IDPERCEPJOIN
FOREIGN KEY (IDRECEPCIONISTA)
REFERENCES RECEPCIONISTA(ID)
ENABLE;

CREATE TABLE JOINMEDICOIPS
(
  IDMEDICO NUMBER,
  IDIPS NUMBER,
  CONSTRAINT JOINMEDICOIPS PRIMARY KEY (IDMEDICO,IDIPS)
);

ALTER TABLE JOINMEDICOIPS
ADD CONSTRAINT FK_MEDICOJOIN
    FOREIGN KEY (IDMEDICO)
    REFERENCES MEDICO(ID)
ENABLE;

ALTER TABLE JOINMEDICOIPS
ADD CONSTRAINT FK_IPSJOINMEDICOIPS
    FOREIGN KEY (IDIPS)
    REFERENCES IPS(ID)
    ENABLE;



CREATE TABLE EXAMENDIAGNOSTICO 
(
  IDSERVICIO NUMBER, 
  CONSTRAINT EXAMENDIAGNOSTICO PRIMARY KEY (IDSERVICIO)
);


ALTER TABLE EXAMENDIAGNOSTICO
ADD CONSTRAINT FK__SERVICIODIAGNOSTICO
 FOREIGN KEY (IDSERVICIO)
 REFERENCES SERVICIO(ID)
 ENABLE; 

CREATE TABLE TERAPIA 
(
  IDSERVICIO NUMBER,
  TIPO VARCHAR2 (50 BYTE),
  NUMEROSESIONES NUMBER(8,2),
  CONSTRAINT TERAPIA PRIMARY KEY (IDSERVICIO)  
);

ALTER TABLE TERAPIA
ADD CONSTRAINT FK__SERVICIOTERAPIA
 FOREIGN KEY (IDSERVICIO)
 REFERENCES SERVICIO(ID)
 ENABLE;

 CREATE TABLE PROCEDIMIENTOESPECIALIZADO 
(
  IDSERVICIO NUMBER,
  TIPO  NUMBER(8,2),
  CONSTRAINT PROCEDIMIENTOESPECIALIZADO PRIMARY KEY (IDSERVICIO)  
);

ALTER TABLE PROCEDIMIENTOESPECIALIZADO
ADD CONSTRAINT FK__SERVICIOESPECIAL
 FOREIGN KEY (IDSERVICIO)
 REFERENCES SERVICIO(ID)
 ENABLE; 

CREATE TABLE TRABAJAN 
(
  ID NUMBER(8,2),
  IDMEDICO NUMBER,
  IDIPS NUMBER,
  CONSTRAINT TRABAJAN PRIMARY KEY (ID)
);

ALTER TABLE TRABAJAN 
ADD CHECK (ID>0)
ENABLE;

ALTER  TABLE  TRABAJAN 
ADD CONSTRAINT FK_MEDICOTRABAJA
FOREIGN KEY (IDMEDICO)
REFERENCES MEDICO(ID)
ENABLE; 

ALTER  TABLE  TRABAJAN 
ADD CONSTRAINT FK_IPSTRABAJA
FOREIGN KEY (IDIPS)
REFERENCES IPS(ID)
ENABLE;

CREATE TABLE ROL 
(
  ID NUMBER,
  NOMBRE VARCHAR2 (255 BYTE)
);

ALTER TABLE ROL
	ADD CONSTRAINT UN_ROL_NOMBRE 
	UNIQUE (NOMBRE)
ENABLE;

CREATE TABLE TIPO_SERVICIO 
(
  ID NUMBER,
  NOMBRE VARCHAR2 (255 BYTE)
);

ALTER TABLE TIPO_SERVICIO
ADD CHECK (NOMBRE IN ('URGENCIA','REMISION','CONTROL','EXAMEN','TERAPIA','ESPECIALIZADO','HOSPITALIZACION' ))
ENABLE;



COMMIT;